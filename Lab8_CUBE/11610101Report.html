<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>实验6：使用CUBE进行中断实验</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
body{ margin: 0 auto; font-family: "Microsoft YaHei", arial,sans-serif; color: #444444; line-height: 1; padding: 30px; } @media screen and (min-width: 768px) { body { width: 748px; margin: 10px auto; } } h1, h2, h3, h4 { color: #111111; font-weight: 400; margin-top: 1em; } h1, h2, h3, h4, h5 { font-family: Georgia, Palatino, serif; } h1, h2, h3, h4, h5, p , dl{ margin-bottom: 16px; padding: 0; } h1 { font-size: 48px; line-height: 54px; } h2 { font-size: 36px; line-height: 42px; } h1, h2 { border-bottom: 1px solid #EFEAEA; padding-bottom: 10px; } h3 { font-size: 24px; line-height: 30px; } h4 { font-size: 21px; line-height: 26px; } h5 { font-size: 18px; list-style: 23px; } a { color: #0099ff; margin: 0; padding: 0; vertical-align: baseline; } a:hover { text-decoration: none; color: #ff6600; } a:visited { /*color: purple;*/ } ul, ol { padding: 0; padding-left: 24px; margin: 0; } li { line-height: 24px; } p, ul, ol { font-size: 16px; line-height: 24px; } ol ol, ul ol { list-style-type: lower-roman; } /*pre { padding: 0px 24px; max-width: 800px; white-space: pre-wrap; } code { font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; }*/ code, pre { border-radius: 3px; background-color:#f7f7f7; color: inherit; } code { font-family: Consolas, Monaco, Andale Mono, monospace; margin: 0 2px; } pre { line-height: 1.7em; overflow: auto; padding: 6px 10px; border-left: 5px solid #6CE26C; } pre > code { border: 0; display: inline; max-width: initial; padding: 0; margin: 0; overflow: initial; line-height: inherit; font-size: .85em; white-space: pre; background: 0 0; } code { color: #666555; } /** markdown preview plus 对于代码块的处理有些问题, 所以使用统一的颜色 */ /*code .keyword { color: #8959a8; } code .number { color: #f5871f; } code .comment { color: #998 }*/ aside { display: block; float: right; width: 390px; } blockquote { border-left:.5em solid #eee; padding: 0 0 0 2em; margin-left:0; } blockquote cite { font-size:14px; line-height:20px; color:#bfbfbf; } blockquote cite:before { content: '\2014 \00A0'; } blockquote p { color: #666; } hr { text-align: left; color: #999; height: 2px; padding: 0; margin: 16px 0; background-color: #e7e7e7; border: 0 none; } dl { padding: 0; } dl dt { padding: 10px 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; } dl dd { padding: 0 16px; margin-bottom: 16px; } dd { margin-left: 0; } /* Code below this line is copyright Twitter Inc. */ button, input, select, textarea { font-size: 100%; margin: 0; vertical-align: baseline; *vertical-align: middle; } button, input { line-height: normal; *overflow: visible; } button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; } button, input[type="button"], input[type="reset"], input[type="submit"] { cursor: pointer; -webkit-appearance: button; } input[type=checkbox], input[type=radio] { cursor: pointer; } /* override default chrome & firefox settings */ input:not([type="image"]), textarea { -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; } input[type="search"] { -webkit-appearance: textfield; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; } input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; } label, input, select, textarea { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 13px; font-weight: normal; line-height: normal; margin-bottom: 18px; } input[type=checkbox], input[type=radio] { cursor: pointer; margin-bottom: 0; } input[type=text], input[type=password], textarea, select { display: inline-block; width: 210px; padding: 4px; font-size: 13px; font-weight: normal; line-height: 18px; height: 18px; color: #808080; border: 1px solid #ccc; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; } select, input[type=file] { height: 27px; line-height: 27px; } textarea { height: auto; } /* grey out placeholders */ :-moz-placeholder { color: #bfbfbf; } ::-webkit-input-placeholder { color: #bfbfbf; } input[type=text], input[type=password], select, textarea { -webkit-transition: border linear 0.2s, box-shadow linear 0.2s; -moz-transition: border linear 0.2s, box-shadow linear 0.2s; transition: border linear 0.2s, box-shadow linear 0.2s; -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); -moz-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); } input[type=text]:focus, input[type=password]:focus, textarea:focus { outline: none; border-color: rgba(82, 168, 236, 0.8); -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(82, 168, 236, 0.6); -moz-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(82, 168, 236, 0.6); box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(82, 168, 236, 0.6); } /* buttons */ button { display: inline-block; padding: 4px 14px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 13px; line-height: 18px; -webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px; -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05); -moz-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05); box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05); background-color: #0064cd; background-repeat: repeat-x; background-image: -khtml-gradient(linear, left top, left bottom, from(#049cdb), to(#0064cd)); background-image: -moz-linear-gradient(top, #049cdb, #0064cd); background-image: -ms-linear-gradient(top, #049cdb, #0064cd); background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #049cdb), color-stop(100%, #0064cd)); background-image: -webkit-linear-gradient(top, #049cdb, #0064cd); background-image: -o-linear-gradient(top, #049cdb, #0064cd); background-image: linear-gradient(top, #049cdb, #0064cd); color: #fff; text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25); border: 1px solid #004b9a; border-bottom-color: #003f81; -webkit-transition: 0.1s linear all; -moz-transition: 0.1s linear all; transition: 0.1s linear all; border-color: #0064cd #0064cd #003f81; border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25); } button:hover { color: #fff; background-position: 0 -15px; text-decoration: none; } button:active { -webkit-box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05); -moz-box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05); box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05); } button::-moz-focus-inner { padding: 0; border: 0; } table { *border-collapse: collapse; /* IE7 and lower */ border-spacing: 0; width: 100%; } table { border: solid #ccc 1px; -moz-border-radius: 6px; -webkit-border-radius: 6px; border-radius: 6px; /*-webkit-box-shadow: 0 1px 1px #ccc; -moz-box-shadow: 0 1px 1px #ccc; box-shadow: 0 1px 1px #ccc; */ } table tr:hover { background: #fbf8e9; -o-transition: all 0.1s ease-in-out; -webkit-transition: all 0.1s ease-in-out; -moz-transition: all 0.1s ease-in-out; -ms-transition: all 0.1s ease-in-out; transition: all 0.1s ease-in-out; } table td, .table th { border-left: 1px solid #ccc; border-top: 1px solid #ccc; padding: 10px; text-align: left; } table th { background-color: #dce9f9; background-image: -webkit-gradient(linear, left top, left bottom, from(#ebf3fc), to(#dce9f9)); background-image: -webkit-linear-gradient(top, #ebf3fc, #dce9f9); background-image: -moz-linear-gradient(top, #ebf3fc, #dce9f9); background-image: -ms-linear-gradient(top, #ebf3fc, #dce9f9); background-image: -o-linear-gradient(top, #ebf3fc, #dce9f9); background-image: linear-gradient(top, #ebf3fc, #dce9f9); /*-webkit-box-shadow: 0 1px 0 rgba(255,255,255,.8) inset; -moz-box-shadow:0 1px 0 rgba(255,255,255,.8) inset; box-shadow: 0 1px 0 rgba(255,255,255,.8) inset;*/ border-top: none; text-shadow: 0 1px 0 rgba(255,255,255,.5); padding: 5px; } table td:first-child, table th:first-child { border-left: none; } table th:first-child { -moz-border-radius: 6px 0 0 0; -webkit-border-radius: 6px 0 0 0; border-radius: 6px 0 0 0; } table th:last-child { -moz-border-radius: 0 6px 0 0; -webkit-border-radius: 0 6px 0 0; border-radius: 0 6px 0 0; } table th:only-child{ -moz-border-radius: 6px 6px 0 0; -webkit-border-radius: 6px 6px 0 0; border-radius: 6px 6px 0 0; } table tr:last-child td:first-child { -moz-border-radius: 0 0 0 6px; -webkit-border-radius: 0 0 0 6px; border-radius: 0 0 0 6px; } table tr:last-child td:last-child { -moz-border-radius: 0 0 6px 0; -webkit-border-radius: 0 0 6px 0; border-radius: 0 0 6px 0; }
</style>
        
    </head>
    <body class="vscode-light">
        <h1 id="%e5%ae%9e%e9%aa%8c6%e4%bd%bf%e7%94%a8cube%e8%bf%9b%e8%a1%8c%e4%b8%ad%e6%96%ad%e5%ae%9e%e9%aa%8c">实验6：使用CUBE进行中断实验</h1>
<p>11610101 韦青茂</p>
<h2 id="%e5%ae%9e%e9%aa%8c%e5%99%a8%e6%9d%90">实验器材</h2>
<ul>
<li>硬件：ARM-STM32开发板，J-Link/St-Link。</li>
<li>软件：Win7/Win8/Win10, Keil uVision5</li>
</ul>
<h2 id="%e5%ae%9e%e9%aa%8c%e8%a6%81%e6%b1%82">实验要求</h2>
<ol>
<li>Use <strong>EXTI</strong> to control the LED: Press <strong>KEY0</strong> to blink <strong>LED0</strong> three times, press <strong>KEY1</strong> to blink <strong>LED1</strong> three
times, and transmit the corresponding message by <strong>UART</strong>.</li>
<li>Receive <strong>UART</strong> data in <strong>non-blocking</strong> mode: when the <strong>UART</strong> receives the text interrupt, transmits the
corresponding message by <strong>UART</strong>.</li>
</ol>
<h2 id="%e5%ae%9e%e9%aa%8c%e8%bf%87%e7%a8%8b">实验过程</h2>
<h3 id="%e8%bd%af%e4%bb%b6%e4%bb%a3%e7%a0%81mainc">软件代码(main.c)</h3>
<pre><code class="language-c"><div><span class="hljs-comment">/* USER CODE BEGIN Header */</span>
<span class="hljs-comment">/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * &lt;h2&gt;&lt;center&gt;&amp;copy; Copyright (c) 2019 STMicroelectronics.
  * All rights reserved.&lt;/center&gt;&lt;/h2&gt;
  *
  * This software component is licensed by ST under BSD 3-Clause license,
  * the "License"; You may not use this file except in compliance with the
  * License. You may obtain a copy of the License at:
  *                        opensource.org/licenses/BSD-3-Clause
  *
  ******************************************************************************
  */</span>
<span class="hljs-comment">/* USER CODE END Header */</span>

<span class="hljs-comment">/* Includes ------------------------------------------------------------------*/</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"main.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"usart.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"gpio.h"</span></span>

<span class="hljs-comment">/* Private includes ----------------------------------------------------------*/</span>
<span class="hljs-comment">/* USER CODE BEGIN Includes */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"string.h"</span></span>
<span class="hljs-comment">/* USER CODE END Includes */</span>

<span class="hljs-comment">/* Private typedef -----------------------------------------------------------*/</span>
<span class="hljs-comment">/* USER CODE BEGIN PTD */</span>
<span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Receive_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData,
<span class="hljs-keyword">uint16_t</span> Size)</span></span>;
<span class="hljs-comment">/* USER CODE END PTD */</span>

<span class="hljs-comment">/* Private define ------------------------------------------------------------*/</span>
<span class="hljs-comment">/* USER CODE BEGIN PD */</span>

<span class="hljs-comment">/* USER CODE END PD */</span>

<span class="hljs-comment">/* Private macro -------------------------------------------------------------*/</span>
<span class="hljs-comment">/* USER CODE BEGIN PM */</span>

<span class="hljs-comment">/* USER CODE END PM */</span>

<span class="hljs-comment">/* Private variables ---------------------------------------------------------*/</span>

<span class="hljs-comment">/* USER CODE BEGIN PV */</span>
<span class="hljs-keyword">uint8_t</span> rxBuffer[<span class="hljs-number">20</span>];
<span class="hljs-keyword">extern</span> UART_HandleTypeDef huart1;
 <span class="hljs-keyword">uint8_t</span> key0Pressed[] = <span class="hljs-string">"Key 0 pressed.\n"</span>;
 <span class="hljs-keyword">uint8_t</span> key1Pressed[] = <span class="hljs-string">"Key 1 pressed.\n"</span>;
 <span class="hljs-keyword">char</span> textForIRQ[] = <span class="hljs-string">"interrupt"</span>;
<span class="hljs-comment">/* USER CODE END PV */</span>

<span class="hljs-comment">/* Private function prototypes -----------------------------------------------*/</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span>;
<span class="hljs-comment">/* USER CODE BEGIN PFP */</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BlinkLed0</span><span class="hljs-params">()</span></span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BlinkLed1</span><span class="hljs-params">()</span></span>;
<span class="hljs-comment">/* USER CODE END PFP */</span>

<span class="hljs-comment">/* Private user code ---------------------------------------------------------*/</span>
<span class="hljs-comment">/* USER CODE BEGIN 0 */</span>

<span class="hljs-comment">/* USER CODE END 0 */</span>

<span class="hljs-comment">/**
  * @brief  The application entry point.
  * @retval int
  */</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-comment">/* USER CODE BEGIN 1 */</span>

  <span class="hljs-comment">/* USER CODE END 1 */</span>
  

  <span class="hljs-comment">/* MCU Configuration--------------------------------------------------------*/</span>

  <span class="hljs-comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span>
  HAL_Init();

  <span class="hljs-comment">/* USER CODE BEGIN Init */</span>

  <span class="hljs-comment">/* USER CODE END Init */</span>

  <span class="hljs-comment">/* Configure the system clock */</span>
  SystemClock_Config();

  <span class="hljs-comment">/* USER CODE BEGIN SysInit */</span>

  <span class="hljs-comment">/* USER CODE END SysInit */</span>

  <span class="hljs-comment">/* Initialize all configured peripherals */</span>
  MX_GPIO_Init();
  MX_USART1_UART_Init();
  <span class="hljs-comment">/* USER CODE BEGIN 2 */</span>
  HAL_UART_Receive_IT(&amp;huart1, (<span class="hljs-keyword">uint8_t</span> *)rxBuffer, <span class="hljs-number">1</span>);
  <span class="hljs-comment">/* USER CODE END 2 */</span>

  <span class="hljs-comment">/* Infinite loop */</span>
  <span class="hljs-comment">/* USER CODE BEGIN WHILE */</span>
  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)
  {
    <span class="hljs-comment">/* USER CODE END WHILE */</span>

    <span class="hljs-comment">/* USER CODE BEGIN 3 */</span>
  }
  <span class="hljs-comment">/* USER CODE END 3 */</span>
}

<span class="hljs-comment">/**
  * @brief System Clock Configuration
  * @retval None
  */</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">SystemClock_Config</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  RCC_OscInitTypeDef RCC_OscInitStruct = {<span class="hljs-number">0</span>};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {<span class="hljs-number">0</span>};

  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks 
  */</span>
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_ON;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;
  <span class="hljs-keyword">if</span> (HAL_RCC_OscConfig(&amp;RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }
  <span class="hljs-comment">/** Initializes the CPU, AHB and APB busses clocks 
  */</span>
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;

  <span class="hljs-keyword">if</span> (HAL_RCC_ClockConfig(&amp;RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)
  {
    Error_Handler();
  }
}

<span class="hljs-comment">/* USER CODE BEGIN 4 */</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_GPIO_EXTI_Callback</span><span class="hljs-params">(<span class="hljs-keyword">uint16_t</span> GPIO_Pin)</span>
</span>{
	 HAL_Delay(<span class="hljs-number">100</span>);
	 <span class="hljs-keyword">switch</span> (GPIO_Pin) {
	 <span class="hljs-keyword">case</span> KEY0_Pin:
		 HAL_Delay(<span class="hljs-number">10</span>);
		 <span class="hljs-keyword">if</span> (HAL_GPIO_ReadPin(KEY0_GPIO_Port, KEY0_Pin) == GPIO_PIN_RESET) {
			 HAL_UART_Transmit(&amp;huart1, key0Pressed, <span class="hljs-number">16</span>, <span class="hljs-number">0xffff</span>);
			 BlinkLed0();
		 }
		 <span class="hljs-keyword">break</span>;
	 <span class="hljs-keyword">case</span> KEY1_Pin:
		 HAL_Delay(<span class="hljs-number">10</span>);
		 <span class="hljs-keyword">if</span> (HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_RESET) {
			 HAL_UART_Transmit(&amp;huart1, key1Pressed, <span class="hljs-number">16</span>, <span class="hljs-number">0xffff</span>);
			 BlinkLed1();
		 }
		 <span class="hljs-keyword">break</span>;
	 <span class="hljs-keyword">case</span> KEY_WK_Pin:
		 HAL_Delay(<span class="hljs-number">10</span>);
		 <span class="hljs-keyword">if</span> (HAL_GPIO_ReadPin(KEY_WK_GPIO_Port, KEY_WK_Pin) == GPIO_PIN_SET) {
			 HAL_GPIO_TogglePin(LED0_GPIO_Port, LED0_Pin);
			 HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);
		 }
		 <span class="hljs-keyword">break</span>;
	 <span class="hljs-keyword">default</span>:
		 <span class="hljs-keyword">break</span>;

	 }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_RxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span>
</span>{
	<span class="hljs-keyword">if</span>(huart-&gt;Instance==USART1)
	{
        <span class="hljs-comment">// 要打印的信息</span>
		<span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span> respond[] = <span class="hljs-string">"Got 'interrupt'.\n"</span>;
		<span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> uRx_Data[<span class="hljs-number">1024</span>] = {<span class="hljs-number">0</span>};
		<span class="hljs-keyword">static</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> uLength = <span class="hljs-number">0</span>;
		<span class="hljs-keyword">if</span>(rxBuffer[<span class="hljs-number">0</span>] == <span class="hljs-string">'\n'</span> || rxBuffer[<span class="hljs-number">0</span>] == <span class="hljs-string">'\0'</span>)
		{
            <span class="hljs-comment">// 把末尾的'\n'或者'\r'替换为'\0'</span>
			uRx_Data[uLength<span class="hljs-number">-1</span>] = <span class="hljs-string">'\0'</span>;
			<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">strcmp</span>(uRx_Data, textForIRQ)){
				HAL_UART_Transmit(&amp;huart1, respond, <span class="hljs-number">17</span>, <span class="hljs-number">0xffff</span>);
			}
			uLength = <span class="hljs-number">0</span>;
		}
		<span class="hljs-keyword">else</span>
		{
			uRx_Data[uLength] = rxBuffer[<span class="hljs-number">0</span>];
			uLength++;
		}
	}
}

<span class="hljs-comment">// 闪烁LED0</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BlinkLed0</span><span class="hljs-params">()</span></span>{
	HAL_GPIO_WritePin(LED0_GPIO_Port, LED0_Pin, GPIO_PIN_RESET);
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">7</span>;i++){
		HAL_GPIO_TogglePin(LED0_GPIO_Port, LED0_Pin);
		HAL_Delay(<span class="hljs-number">200</span>);
	}
}
<span class="hljs-comment">// 闪烁LED1</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">BlinkLed1</span><span class="hljs-params">()</span></span>{
	HAL_GPIO_WritePin(LED1_GPIO_Port, LED1_Pin, GPIO_PIN_RESET);
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">7</span>;i++){
		HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);
		HAL_Delay(<span class="hljs-number">200</span>);
	}
}
<span class="hljs-comment">/* USER CODE END 4 */</span>

<span class="hljs-comment">/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Error_Handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span>
</span>{
  <span class="hljs-comment">/* USER CODE BEGIN Error_Handler_Debug */</span>
  <span class="hljs-comment">/* User can add his own implementation to report the HAL error return state */</span>

  <span class="hljs-comment">/* USER CODE END Error_Handler_Debug */</span>
}

<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span>  USE_FULL_ASSERT</span>
<span class="hljs-comment">/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assert_failed</span><span class="hljs-params">(<span class="hljs-keyword">uint8_t</span> *file, <span class="hljs-keyword">uint32_t</span> line)</span>
</span>{ 
  <span class="hljs-comment">/* USER CODE BEGIN 6 */</span>
  <span class="hljs-comment">/* User can add his own implementation to report the file name and line number,
     tex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */</span>
  <span class="hljs-comment">/* USER CODE END 6 */</span>
}
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_FULL_ASSERT */</span></span>

<span class="hljs-comment">/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/</span>

</div></code></pre>
<h3 id="%e4%b8%b2%e5%8f%a3%e5%ae%9e%e9%aa%8c">串口实验：</h3>
<p>实现echo功能:
<img src="file:///C:/Users/User/Desktop/Embedded/Lab5_CUBE/img.jpg" alt="serial"></p>
<h2 id="%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98%e5%8f%8a%e8%a7%a3%e5%86%b3%e6%96%b9%e6%b3%95">遇到的问题及解决方法</h2>
<h3 id="1-%e4%b8%b2%e5%8f%a3%e6%98%8e%e6%98%8e%e5%8f%91%e9%80%81%e4%ba%86%22intrrupt%22%e5%8d%b4%e6%b2%a1%e6%9c%89%e5%8c%b9%e9%85%8d%e6%88%90%e5%8a%9f">1. 串口明明发送了&quot;intrrupt&quot;却没有匹配成功</h3>
<p>因为串口软件发送时会自动在末尾加一个'\r',需要将它删掉</p>
<pre><code class="language-c"><div> <span class="hljs-comment">// 把末尾的'\n'或者'\r'替换为'\0'</span>
 uRx_Data[uLength<span class="hljs-number">-1</span>] = <span class="hljs-string">'\0'</span>;
</div></code></pre>
<p>这样打印该字符串时就会以这个手动添加的'\0'作为结束符</p>

    </body>
    </html>