<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>实验2：点亮2个LED灯</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
body{ margin: 0 auto; font-family: "Microsoft YaHei", arial,sans-serif; color: #444444; line-height: 1; padding: 30px; } @media screen and (min-width: 768px) { body { width: 748px; margin: 10px auto; } } h1, h2, h3, h4 { color: #111111; font-weight: 400; margin-top: 1em; } h1, h2, h3, h4, h5 { font-family: Georgia, Palatino, serif; } h1, h2, h3, h4, h5, p , dl{ margin-bottom: 16px; padding: 0; } h1 { font-size: 48px; line-height: 54px; } h2 { font-size: 36px; line-height: 42px; } h1, h2 { border-bottom: 1px solid #EFEAEA; padding-bottom: 10px; } h3 { font-size: 24px; line-height: 30px; } h4 { font-size: 21px; line-height: 26px; } h5 { font-size: 18px; list-style: 23px; } a { color: #0099ff; margin: 0; padding: 0; vertical-align: baseline; } a:hover { text-decoration: none; color: #ff6600; } a:visited { /*color: purple;*/ } ul, ol { padding: 0; padding-left: 24px; margin: 0; } li { line-height: 24px; } p, ul, ol { font-size: 16px; line-height: 24px; } ol ol, ul ol { list-style-type: lower-roman; } /*pre { padding: 0px 24px; max-width: 800px; white-space: pre-wrap; } code { font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; }*/ code, pre { border-radius: 3px; background-color:#f7f7f7; color: inherit; } code { font-family: Consolas, Monaco, Andale Mono, monospace; margin: 0 2px; } pre { line-height: 1.7em; overflow: auto; padding: 6px 10px; border-left: 5px solid #6CE26C; } pre > code { border: 0; display: inline; max-width: initial; padding: 0; margin: 0; overflow: initial; line-height: inherit; font-size: .85em; white-space: pre; background: 0 0; } code { color: #666555; } /** markdown preview plus 对于代码块的处理有些问题, 所以使用统一的颜色 */ /*code .keyword { color: #8959a8; } code .number { color: #f5871f; } code .comment { color: #998 }*/ aside { display: block; float: right; width: 390px; } blockquote { border-left:.5em solid #eee; padding: 0 0 0 2em; margin-left:0; } blockquote cite { font-size:14px; line-height:20px; color:#bfbfbf; } blockquote cite:before { content: '\2014 \00A0'; } blockquote p { color: #666; } hr { text-align: left; color: #999; height: 2px; padding: 0; margin: 16px 0; background-color: #e7e7e7; border: 0 none; } dl { padding: 0; } dl dt { padding: 10px 0; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; } dl dd { padding: 0 16px; margin-bottom: 16px; } dd { margin-left: 0; } /* Code below this line is copyright Twitter Inc. */ button, input, select, textarea { font-size: 100%; margin: 0; vertical-align: baseline; *vertical-align: middle; } button, input { line-height: normal; *overflow: visible; } button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; } button, input[type="button"], input[type="reset"], input[type="submit"] { cursor: pointer; -webkit-appearance: button; } input[type=checkbox], input[type=radio] { cursor: pointer; } /* override default chrome & firefox settings */ input:not([type="image"]), textarea { -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; } input[type="search"] { -webkit-appearance: textfield; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; } input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; } label, input, select, textarea { font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 13px; font-weight: normal; line-height: normal; margin-bottom: 18px; } input[type=checkbox], input[type=radio] { cursor: pointer; margin-bottom: 0; } input[type=text], input[type=password], textarea, select { display: inline-block; width: 210px; padding: 4px; font-size: 13px; font-weight: normal; line-height: 18px; height: 18px; color: #808080; border: 1px solid #ccc; -webkit-border-radius: 3px; -moz-border-radius: 3px; border-radius: 3px; } select, input[type=file] { height: 27px; line-height: 27px; } textarea { height: auto; } /* grey out placeholders */ :-moz-placeholder { color: #bfbfbf; } ::-webkit-input-placeholder { color: #bfbfbf; } input[type=text], input[type=password], select, textarea { -webkit-transition: border linear 0.2s, box-shadow linear 0.2s; -moz-transition: border linear 0.2s, box-shadow linear 0.2s; transition: border linear 0.2s, box-shadow linear 0.2s; -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); -moz-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1); } input[type=text]:focus, input[type=password]:focus, textarea:focus { outline: none; border-color: rgba(82, 168, 236, 0.8); -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(82, 168, 236, 0.6); -moz-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(82, 168, 236, 0.6); box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(82, 168, 236, 0.6); } /* buttons */ button { display: inline-block; padding: 4px 14px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 13px; line-height: 18px; -webkit-border-radius: 4px; -moz-border-radius: 4px; border-radius: 4px; -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05); -moz-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05); box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 1px 2px rgba(0, 0, 0, 0.05); background-color: #0064cd; background-repeat: repeat-x; background-image: -khtml-gradient(linear, left top, left bottom, from(#049cdb), to(#0064cd)); background-image: -moz-linear-gradient(top, #049cdb, #0064cd); background-image: -ms-linear-gradient(top, #049cdb, #0064cd); background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #049cdb), color-stop(100%, #0064cd)); background-image: -webkit-linear-gradient(top, #049cdb, #0064cd); background-image: -o-linear-gradient(top, #049cdb, #0064cd); background-image: linear-gradient(top, #049cdb, #0064cd); color: #fff; text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25); border: 1px solid #004b9a; border-bottom-color: #003f81; -webkit-transition: 0.1s linear all; -moz-transition: 0.1s linear all; transition: 0.1s linear all; border-color: #0064cd #0064cd #003f81; border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25); } button:hover { color: #fff; background-position: 0 -15px; text-decoration: none; } button:active { -webkit-box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05); -moz-box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05); box-shadow: inset 0 3px 7px rgba(0, 0, 0, 0.15), 0 1px 2px rgba(0, 0, 0, 0.05); } button::-moz-focus-inner { padding: 0; border: 0; } table { *border-collapse: collapse; /* IE7 and lower */ border-spacing: 0; width: 100%; } table { border: solid #ccc 1px; -moz-border-radius: 6px; -webkit-border-radius: 6px; border-radius: 6px; /*-webkit-box-shadow: 0 1px 1px #ccc; -moz-box-shadow: 0 1px 1px #ccc; box-shadow: 0 1px 1px #ccc; */ } table tr:hover { background: #fbf8e9; -o-transition: all 0.1s ease-in-out; -webkit-transition: all 0.1s ease-in-out; -moz-transition: all 0.1s ease-in-out; -ms-transition: all 0.1s ease-in-out; transition: all 0.1s ease-in-out; } table td, .table th { border-left: 1px solid #ccc; border-top: 1px solid #ccc; padding: 10px; text-align: left; } table th { background-color: #dce9f9; background-image: -webkit-gradient(linear, left top, left bottom, from(#ebf3fc), to(#dce9f9)); background-image: -webkit-linear-gradient(top, #ebf3fc, #dce9f9); background-image: -moz-linear-gradient(top, #ebf3fc, #dce9f9); background-image: -ms-linear-gradient(top, #ebf3fc, #dce9f9); background-image: -o-linear-gradient(top, #ebf3fc, #dce9f9); background-image: linear-gradient(top, #ebf3fc, #dce9f9); /*-webkit-box-shadow: 0 1px 0 rgba(255,255,255,.8) inset; -moz-box-shadow:0 1px 0 rgba(255,255,255,.8) inset; box-shadow: 0 1px 0 rgba(255,255,255,.8) inset;*/ border-top: none; text-shadow: 0 1px 0 rgba(255,255,255,.5); padding: 5px; } table td:first-child, table th:first-child { border-left: none; } table th:first-child { -moz-border-radius: 6px 0 0 0; -webkit-border-radius: 6px 0 0 0; border-radius: 6px 0 0 0; } table th:last-child { -moz-border-radius: 0 6px 0 0; -webkit-border-radius: 0 6px 0 0; border-radius: 0 6px 0 0; } table th:only-child{ -moz-border-radius: 6px 6px 0 0; -webkit-border-radius: 6px 6px 0 0; border-radius: 6px 6px 0 0; } table tr:last-child td:first-child { -moz-border-radius: 0 0 0 6px; -webkit-border-radius: 0 0 0 6px; border-radius: 0 0 0 6px; } table tr:last-child td:last-child { -moz-border-radius: 0 0 6px 0; -webkit-border-radius: 0 0 6px 0; border-radius: 0 0 6px 0; }
</style>
        
    </head>
    <body>
        <h1 id="%e5%ae%9e%e9%aa%8c2%e7%82%b9%e4%ba%ae2%e4%b8%aaled%e7%81%af">实验2：点亮2个LED灯</h1>
<p>11610101 韦青茂</p>
<h2 id="%e5%ae%9e%e9%aa%8c%e5%99%a8%e6%9d%90">实验器材</h2>
<ul>
<li>硬件：ARM-STM32开发板，J-Link/St-Link。</li>
<li>软件：Win7/Win8/Win10, Keil uVision5</li>
</ul>
<h2 id="%e5%ae%9e%e9%aa%8c%e8%a6%81%e6%b1%82">实验要求</h2>
<ol>
<li>
<p>归纳总结创建工程过程中遇到的问题以及解决方法。</p>
</li>
<li>
<p>例程中 PA8 对应开发板上的 DS0， DS1 对应的 IO 口为 PD2，且 IO 口状态为 0 时灯亮，状态为 1 时灭，亮灭交替可表现为闪烁状态，还可以设置快速、慢速 闪烁等状态，以及两个灯同时亮灭或者交替一亮一灭等状态。要求： 模拟用两个 LED 灯的应用场景下使用方式三种状态，系统正常运行、一般异常 （warning）、严重警告（error） 注意：模拟时可以依次显示多种闪烁状态。</p>
</li>
<li>
<p>提交 main.c 的内容，提交仿真界面 LogicAnalyzer的截图画面，放 在一个实验报告里，保存为 PDF 文件提交到 SAKAI 系统。 课上会抽查，进行实 际运行、验证。</p>
</li>
</ol>
<h2 id="%e5%ae%9e%e9%aa%8c%e8%bf%87%e7%a8%8b">实验过程</h2>
<h3 id="%e8%bd%af%e4%bb%b6%e4%bb%a3%e7%a0%81mainc">软件代码(main.c)</h3>
<pre><code class="language-c"><div><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stm32f10x.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"sys.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"delay.h"</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_RED 0</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LED_YELLOW 1</span>

<span class="hljs-comment">// 开灯</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lightOn</span><span class="hljs-params">(<span class="hljs-keyword">int</span> lightID)</span></span>{
	<span class="hljs-keyword">switch</span> (lightID)
	{
	<span class="hljs-keyword">case</span> LED_RED:
		GPIO_ResetBits(GPIOA, GPIO_Pin_8);
		<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> LED_YELLOW:
		GPIO_ResetBits(GPIOD, GPIO_Pin_2);
		<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">break</span>;
	}
}
<span class="hljs-comment">//　关灯</span>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">lightOff</span><span class="hljs-params">(<span class="hljs-keyword">int</span> lightID)</span></span>{
	<span class="hljs-keyword">switch</span> (lightID)
	{
	<span class="hljs-keyword">case</span> LED_RED:
		GPIO_SetBits(GPIOA, GPIO_Pin_8);
		<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">case</span> LED_YELLOW:
		GPIO_SetBits(GPIOD, GPIO_Pin_2);
		<span class="hljs-keyword">break</span>;
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">break</span>;
	}
}

<span class="hljs-comment">// 对应关系 ： PA8 —— led0      PD2 —— led1        IO状态为低时灯亮，为高时灭</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
	<span class="hljs-keyword">int</span> normal = <span class="hljs-number">8</span>;
	<span class="hljs-keyword">int</span> warning = <span class="hljs-number">8</span>;
	<span class="hljs-keyword">int</span> error = <span class="hljs-number">8</span>;

	GPIO_InitTypeDef GPIO_InitStructure;
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA | RCC_APB2Periph_GPIOD, ENABLE); <span class="hljs-comment">//使能PA,PD端口时钟</span>

	delay_init();
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8;		  <span class="hljs-comment">//LED0--&gt;PA.8 端口配置</span>
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;  <span class="hljs-comment">//推挽输出</span>
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz; <span class="hljs-comment">//IO口速度为50MHz</span>
	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);			  <span class="hljs-comment">//根据设定参数初始化GPIOA.8</span>

	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
	GPIO_Init(GPIOD, &amp;GPIO_InitStructure);
	GPIO_SetBits(GPIOD, GPIO_Pin_2);


	<span class="hljs-keyword">while</span> (normal--)<span class="hljs-comment">//正常状态，黄灯常亮，红灯关闭</span>
	{
		lightOn(LED_YELLOW);
		lightOff(LED_RED);
		delay_ms(<span class="hljs-number">2000</span>);
	}
	<span class="hljs-keyword">while</span> (warning--)<span class="hljs-comment">//警告状态，黄灯闪烁，红灯关闭</span>
	{
		delay_ms(<span class="hljs-number">2000</span>);
		lightOn(LED_YELLOW);
		lightOff(LED_RED);
		delay_ms(<span class="hljs-number">2000</span>);
		lightOff(LED_YELLOW);
	}
	<span class="hljs-keyword">while</span> (error--)<span class="hljs-comment">//错误状态， 红灯黄灯交替闪烁</span>
	{
		delay_ms(<span class="hljs-number">2000</span>);
		lightOn(LED_YELLOW);
		lightOff(LED_RED);
		delay_ms(<span class="hljs-number">2000</span>);
		lightOn(LED_RED);
		lightOff(LED_YELLOW);
	}
	lightOff(LED_RED);
}
</div></code></pre>
<h3 id="%e4%bb%bf%e7%9c%9f%e6%88%aa%e5%9b%be">仿真截图：</h3>
<p><img src="file:///C:/Users/User/Desktop/Embemded/1.png" alt="asd"></p>
<ul>
<li>正常状态： 黄灯常亮</li>
<li>警告状态： 黄灯闪烁</li>
<li>错误状态： 黄灯红灯交替闪烁</li>
</ul>
<h2 id="%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98%e5%8f%8a%e8%a7%a3%e5%86%b3%e6%96%b9%e6%b3%95">遇到的问题及解决方法</h2>
<h3 id="load%e6%8c%89%e9%92%ae%e7%81%b0%e8%89%b2%e6%97%a0%e6%b3%95%e4%b8%8a%e4%bc%a0%e4%bb%a3%e7%a0%81">load按钮灰色，无法上传代码</h3>
<p>仿真确认运行如预期后，想要load到板上进行实际运行验证。可是load按钮是灰色的，无法点击。此时需要再回到debug选项中将 use jlink 重新选上，而不是 use simulator。勾选后即可load。</p>
<h3 id="load%e6%88%90%e5%8a%9f%e5%90%8e%e6%9d%bf%e5%ad%90%e6%b2%a1%e6%9c%89%e5%8f%8d%e5%ba%94">load成功后板子没有反应</h3>
<p>load成功后，板子上的led灯没有按照预期闪烁。此时需要按下RST按钮才可以让板子按照代码运行。</p>

    </body>
    </html>